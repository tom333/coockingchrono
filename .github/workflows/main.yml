name: Build
on: [push, pull_request]

jobs:
  # Build job. Builds app for Android with Buildozer
  build-android:
    name: Build for Android
    runs-on: ubuntu-latest

    steps:
      - name: Checkout
        uses: actions/checkout@v2
      # In this step, this action saves a list of existing images,
      # the cache is created without them in the post run.
      # It also restores the cache if it exists.
      - uses: satackey/action-docker-layer-caching@v0.0.11
        # Ignore the failure of a step and avoid terminating the job.
        continue-on-error: true

      - name: Build with Buildozer
        uses: tom333/buildozer-action@main
        id: buildozer
        with:
          workdir: .
          buildozer_version: stable
#       - name: Bump version and push tag
#         if: github.ref == 'refs/heads/main'
#         id: tag_version
#         uses: mathieudutour/github-tag-action@v5.3
#         with:
#           github_token: ${{ secrets.GITHUB_TOKEN }}
#       - name: Create a GitHub release
#         if: github.ref == 'refs/heads/main'
#         uses: softprops/action-gh-release@v1
#         env:
#           GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
#         with:
#           tag_name: ${{ steps.tag_version.outputs.new_tag }}
#           name: Release ${{ steps.tag_version.outputs.new_tag }}
#           body: ${{ steps.tag_version.outputs.changelog }}
#           file: ${{ steps.buildozer.outputs.filename }}

